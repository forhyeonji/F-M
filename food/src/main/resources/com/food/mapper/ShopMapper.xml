<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.food.mapper.ShopMapper">


	<!-- 상품등록(일대일 이미지라 같이 넣음) -->
	<insert id="Shopenroll">
	
	 	<selectKey keyProperty="prodnum" order="BEFORE" resultType="int">
			select ifnull(max(prodnum),0)+1 prodnum
			from tb_shop;
  		</selectKey>
	
		insert into	tb_shop(prodnum,NAME,Origin,subcontent,CONTENT,price2,discountprice,Parcel,packaging,unit,boundary,detail)
		value(#{prodnum},#{NAME},#{Origin},#{subcontent},#{CONTENT},#{discountprice},#{price2},#{Parcel},#{packaging},#{unit},#{boundary},#{detail});
	</insert>
		
		

	<insert id="ShopEdit">
		insert into
		tb_shop(prodnum,NAME,Origin,subcontent,CONTENT,price2,discountprice,Parcel,packaging,unit,boundary,detail)
		value(#{prodnum},#{NAME},#{Origin},#{subcontent},#{CONTENT},#{discountprice},#{price2},#{Parcel},#{packaging},#{unit},#{boundary},#{detail});
	</insert>



	<!-- 상품등록시 분류 -->
	<select id="class1" resultType="com.food.model.ShopdivisionVO">
		select distinct(class1) from
		sh_division
	</select>

	<select id="class2" resultType="com.food.model.ShopdivisionVO">
		select class2 from sh_division
		where class1=#{class1}
	</select>

	<!-- 상품리스트 -->
	<!-- <select id="listsub" resultType="com.food.model.ShopVO">
		select*
		from(
		select @rownum :=@rownum+1 rownum,s.*
		from (select
		s.prodnum,Name,discountprice,today,Concat(Replace(uploadpath,'\\','/'),'/',uuid,'-',filename)filename
		from tb_shop s, sh_appatch a
		where s.prodnum = a.prodnum)s, (select @rownum:=0) as tmp) as
		shopProductlist
		order by prodnum asc
		
		<if test = "keyword != null">
                <choose>
                   <when test="type == 'sh_Tp'.toString()">
                      where title like concat('%',#{keyword},'%') 
                   </when>
                   <when test="type == 'sh_Tk'.toString()">
                      where context like concat('%',#{keyword},'%') 
                   </when>
                   <otherwise>
                     where (Name like concat('%',#{keyword},'%')
                      or prodnum like concat('%',#{keyword},'%')) 
                   </otherwise>
                </choose>
            </if>
		<![CDATA[
		where rownum > (#{pageNum}-1)*#{amount} and rownum <= #{pageNum}*#{amount} and division = "m"
		]]>
	</select> -->
	
	<select id="list" resultType="com.food.model.ShopVO">
	select*
	from(
	select @rownum :=@rownum+1 rownum,s.*
	from (select
	s.prodnum,Name,discountprice,today,Concat(Replace(uploadpath,'\\','/'),'/',uuid,'-',filename)filename
	from tb_shop s inner join sh_appatch a
	on s.prodnum = a.prodnum
	<if test = "keyword != null">
                <choose>
                   <when test="type == 'sh_Tp'.toString()">
                      where title like concat('%',#{keyword},'%') 
                   </when>
                   <when test="type == 'sh_Tk'.toString()">
                      where context like concat('%',#{keyword},'%') 
                   </when>
                   <otherwise>
                     where (Name like concat('%',#{keyword},'%')
                      or prodnum like concat('%',#{keyword},'%')) 
                   </otherwise>
                </choose>
            </if>
            )as s, (select @rownum:=0) as tmp) as
	shopProductlist
	<![CDATA[
		where rownum > (#{pageNum}-1)*#{amount} and rownum <= #{pageNum}*#{amount} 
		]]>
	order by prodnum desc;

	</select>

<select id="total" resultType="int">

	select count(*)
	from tb_shop t join sh_appatch s
	on t.prodnum = s.prodnum;
	<if test = "keyword != null">
                <choose>
                   <when test="type == 'sh_Tp'.toString()">
                      where title like concat('%',#{keyword},'%') 
                   </when>
                   <when test="type == 'sh_Tk'.toString()">
                      where context like concat('%',#{keyword},'%') 
                   </when>
                    </choose>
            </if>
</select>

</mapper>