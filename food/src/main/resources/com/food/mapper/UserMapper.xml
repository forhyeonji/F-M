<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.food.mapper.UserMapper">
    <insert id="join">
        insert into tb_user(user_email, user_id, user_pw, user_name, user_zip, user_addr1, user_addr2, user_gender, user_phone)
        values(#{user_email},#{user_id},#{user_pw},#{user_name},#{user_zip},#{user_addr1},#{user_addr2},#{user_gender},#{user_phone})
    </insert>

    <select id="login" resultType="com.food.model.UserVO">
        select user_id, user_pw
        from tb_user
        where user_id = #{user_id} and user_pw = #{user_pw}
    </select>
    
    <!-- 아이디 중복검사 -->
  	<select id="idCheck" resultType="int">	
  		select count(*) 
  		from tb_user 
  		where user_id = #{user_id} 	
  	</select>
	
	<!-- 휴대폰 중복검사 -->
  	<select id="phoneCheck" resultType="int">
  		select count(*) 
  		from tb_user 
  		where user_phone = #{user_phone}
  	</select>



	<select id="find_id" resultType="com.food.model.UserVO">
		select * 
		from tb_user 
		where user_name=#{user_name} and user_phone=#{user_phone}
	</select>
	
	<select id="find_pw" resultType="com.food.model.UserVO">
		select * 
		from tb_user 
		where user_id=#{user_id} and user_name=#{user_name} and user_phone=#{user_phone}
	</select>
	
	<update id="updatePassword">
		update tb_user 
		set user_pw=#{user_pw} where user_id=#{user_id}
	</update>
	
	
	
	
	
	
	
	
	
	
	
	<!-- 상품리스트 총갯수 -->
	<select id="total" resultType="int">
	select count(*)
	from tb_shop t join sh_appatch s
	on t.prodnum = s.prodnum
	<if test = "keyword != null">
                <choose>
                   <when test="type == 'sh_Tp'.toString()">
                      and NAME like concat('%',#{keyword},'%') 
                   </when>
                   <when test="type == 'sh_Tk'.toString()">
                      and s.prodnum like concat('%',#{keyword},'%') 
                   </when>
                   <otherwise>
                     where (NAME like concat('%',#{keyword},'%')
                      or s.prodnum like concat('%',#{keyword},'%')) 
                   </otherwise>
                    </choose>
            </if>
</select>
	
	<!-- 쇼핑몰 메인 내용 -->
<select id="ShopSelect" resultType="com.food.model.ShopVO">
SELECT 
	rownum,prodnum,NAME,subcontent,division,Concat(Replace(uploadPath,'\\','/') ,<![CDATA['/']]>,uuid,'-' ,filename)AS filename, discountprice
FROM  (
		SELECT   @rownum:=@rownum+1 rownum,a.* 
		FROM (SELECT * 
					FROM (
 						SELECT  t.prodnum,NAME,subcontent,division,uuid,filename,uploadPath, discountprice
							FROM   tb_shop t  JOIN  sh_appatch s ON  t.prodnum = s.prodnum WHERE  image = 1 and division = 'm' )AS j ) AS a,(
										SELECT @rownum:=0) AS tmp ORDER BY prodnum DESC) AS balist
</select>

	
	<select id="main" resultType="com.food.model.ShopVO">
SELECT 
	rownum,prodnum,NAME,subcontent,division,CONTENT,origin,Parcel,packaging,unit,detail,boundary,Concat(Replace(uploadPath,'\\','/') ,'/',uuid,'-' ,filename)AS filename, discountprice
FROM  (
		SELECT   @rownum:=@rownum+1 rownum,a.* 
		FROM (SELECT * 
					FROM (
 						SELECT  t.prodnum,NAME,subcontent,division,origin,uuid,filename,uploadPath ,discountprice  ,CONTENT,Parcel,packaging,unit,detail,boundary                                       
							FROM   tb_shop t  JOIN  sh_appatch s ON  t.prodnum = s.prodnum WHERE  t.prodnum= #{prodnum} and division = 	'm' )AS j ) AS a,(
										SELECT @rownum:=0) AS tmp ORDER BY prodnum DESC) AS balist
;
</select>

	<select id="Shopattachlist"
		resultType="com.food.model.ShopAttachVO">
		select*from sh_appatch where prodnum=#{prodnum}
	</select>
	
	
  	
  	
  	
  
  	

	
</mapper>